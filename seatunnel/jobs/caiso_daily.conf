# SeaTunnel Configuration for CAISO Daily Data Ingestion

env {
  parallelism = 4
  job.mode = "BATCH"
  checkpoint.interval = 1000
}

source {
  CAISO_Connector {
    market = "CAISO"
    endpoint = "${CAISO_API_URL}"
    authToken = "${CAISO_API_TOKEN}"
    mode = "batch"
    startDate = "${START_DATE}"
    endDate = "${END_DATE}"
    node = "${CAISO_NODE}"
    retryAttempts = 3
    retryDelay = 2000
  }
}

transform {
  JsonFlattener {}
  TimezoneStandardizer { 
    target_tz = "UTC" 
  }
  DataValidator {
    schema_path = "schemas/raw_caiso_trade.avsc"
    strict_mode = false
  }
  QualityChecker {
    completeness_threshold = 0.95
    accuracy_threshold = 0.90
  }
  DataEnricher {
    addMetadata = true
    addTimestamps = true
  }
}

sink {
  Kafka {
    topic = "ingestion.caiso.raw.v1"
    bootstrapServers = "${KAFKA_BOOTSTRAP}"
    format = "json"
    producerConfig = {
      "acks" = "all"
      "retries" = 3
      "batch.size" = 32768
      "linger.ms" = 10
      "buffer.memory" = 67108864
    }
  }
}
