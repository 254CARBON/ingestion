# SeaTunnel Configuration for MISO Real-time Data Ingestion

env {
  parallelism = 2
  job.mode = "STREAMING"
  checkpoint.interval = 10000
}

source {
  MISO_Connector {
    market = "MISO"
    endpoint = "${MISO_API_URL}"
    authToken = "${MISO_API_TOKEN}"
    mode = "realtime"
    pollInterval = 5000
    maxRecordsPerPoll = 1000
    retryAttempts = 3
    retryDelay = 1000
  }
}

transform {
  JsonFlattener {}
  TimezoneStandardizer { 
    target_tz = "UTC" 
  }
  DataValidator {
    schema_path = "schemas/raw_miso_trade.avsc"
    strict_mode = false
  }
  QualityChecker {
    completeness_threshold = 0.95
    accuracy_threshold = 0.90
  }
}

sink {
  Kafka {
    topic = "ingestion.miso.raw.v1"
    bootstrapServers = "${KAFKA_BOOTSTRAP}"
    format = "json"
    producerConfig = {
      "acks" = "all"
      "retries" = 3
      "batch.size" = 16384
      "linger.ms" = 5
      "buffer.memory" = 33554432
    }
  }
}
